import"./style.css";import Chart from"chart.js/auto";import{format,fromUnixTime}from"date-fns";import{dom}from"./modules";async function getWeatherData(t){const e=await fetch(`https://weather.visualcrossing.com/VisualCrossingWebServices/rest/services/timeline/${t}?unitGroup=metric&key=EHJZF3GRS5GHMG9G89JCY82YJ&contentType=json`,{mode:"cors"}),a=await e.json(),i=await a.days.flatMap((t=>t.hours.map((t=>({hours:parseInt(format(fromUnixTime(t.datetimeEpoch),"H")),days:format(fromUnixTime(t.datetimeEpoch),"EEEE dd.MM"),temp:t.temp,icon:t.icon,precip:t.precip,windDirection:t.winddir,windSpeed:t.windspeed,windGust:t.windgust}))))),n=await a.days.map((t=>({dataTemperature:`min ${parseInt(t.tempmin)}° max ${parseInt(t.tempmax)}°`,dataPrecipitation:`total ${t.precip}mm`,dataWind:`max ${parseInt(t.windspeed)}  (${parseInt(t.windgust)}) km/h`})));document.querySelector("#location").textContent=`Meteogram for ${a.address}`,plotDates("#dates",i),plotLineChart("#temperatureGraphDiv",i,"hours","temp"),plotIcons("#icons",i),plotBarChart("#precipitationGraphDiv",i,"hours","precip"),plotWindDirection("#windDirection",i),plotLineChart("#windGraphDiv",i,"hours","","windSpeed","windGust"),plotText("#dataTemperature",n,"dataTemperature"),plotText("#dataPrecipitation",n,"dataPrecipitation"),plotText("#dataWind",n,"dataWind")}getWeatherData("Innsbruck");const aspectRatio=3/40,actualWidthCanvas=6e3,actualHeightCanvas=.075*actualWidthCanvas,scaledWidthCanvas=2400,scaledHeightCanvas=.075*scaledWidthCanvas,width1day=scaledWidthCanvas/15;function plotDates(t,e){document.querySelector(t).innerHTML="",e.map((t=>t.days)).forEach(((e,a)=>{a%24==0&&dom.addElement(t,"span",e,{style:`width: ${width1day}px`})}))}function plotText(t,e,a){document.querySelector(t).innerHTML="",e.map((t=>t[a])).forEach((e=>{dom.addElement(t,"span",e,{style:`width: ${width1day}px`})}))}function plotIcons(t,e){document.querySelector(t).innerHTML="",e.map((t=>t.icon)).forEach(((e,a)=>{a%6==3&&dom.addElement(t,"img","",{src:`https://raw.githubusercontent.com/visualcrossing/WeatherIcons/58c79610addf3d4d91471abbb95b05e96fb43019/SVG/2nd%20Set%20-%20Color/${e}.svg`,style:`width: ${width1day/4}px`})}))}function plotWindDirection(t,e){document.querySelector(t).innerHTML="",e.map((t=>t.windDirection)).forEach(((e,a)=>{a%3==0&&dom.addElement(t,"span","navigation",{class:"material-symbols-outlined",style:`transform: rotate(${e}deg); width: ${width1day/8}px`})}))}const chartOptions={responsive:!1,maintainAspectRatio:!0,scales:{y:{grid:{color:"rgba(47, 79, 79, 0.5)",lineWidth:t=>0===t.tick.value?4:2},ticks:{display:!1}},x:{ticks:{display:!1},grid:{color:"rgba(47, 79, 79, 0.5)",lineWidth:4},afterBuildTicks:function(t){t.ticks=t.ticks.filter(((t,e)=>e%24==0&&0!==e))}}},plugins:{legend:{display:!1},ticks:{display:!1}},layout:{padding:{left:-7,bottom:-7}}};function plotLineChart(t,e,a,i,n,o){document.querySelector(t).innerHTML="";const d=Date.now();dom.addElement(t,"canvas","",{id:d,width:actualWidthCanvas,height:actualHeightCanvas,style:`width: ${scaledWidthCanvas}px; height: ${scaledHeightCanvas}px`}),new Chart(document.getElementById(d),{data:{labels:e.map((t=>t[a])),datasets:[{type:"line",data:e.map((t=>t[i])),borderColor:"red",borderWidth:4,tension:.5,pointRadius:0},{type:"line",data:e.map((t=>t[n])),borderColor:"blue",borderWidth:4,tension:.5,pointRadius:0},{type:"line",data:e.map((t=>t[o])),borderColor:"purple",borderWidth:4,tension:.5,pointRadius:0}]},options:chartOptions})}function plotBarChart(t,e,a,i){document.querySelector(t).innerHTML="";const n=Date.now();dom.addElement(t,"canvas","",{id:n,width:actualWidthCanvas,height:actualHeightCanvas,style:`width: ${scaledWidthCanvas}px; height: ${scaledHeightCanvas}px`}),new Chart(document.getElementById(n),{data:{labels:e.map((t=>t[a])),datasets:[{type:"bar",data:e.map((t=>t[i]))}]},options:chartOptions})}document.querySelector("input").addEventListener("keydown",(t=>{if("Enter"==t.key){const e=t.target;getWeatherData(e.value),e.value="",e.blur()}})),document.querySelector(".searchIcon").addEventListener("click",(()=>{const t=document.querySelector("input");getWeatherData(t.value),t.value="",t.blur()}));